<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supabase Plot Demo</title>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <h1>Supabase Live Plot Demo</h1>

  <input type="number" id="valueInput" placeholder="Enter a number">
  <button onclick="addData()">Add Data</button>

  <canvas id="myChart" width="400" height="200"></canvas>

  <script>
    // ‚úÖ YOUR SUPABASE CREDENTIALS
    const SUPABASE_URL = "https://sugekxazhhxmbzncqxyg.supabase.co";
    const SUPABASE_KEY = "sb_publishable_84h5tEu4ALMHkJWBxQeYdw_WqSSJiKd";

    // ‚úÖ Create client
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    console.log("‚úÖ Supabase client initialized");

    // ‚úÖ Setup Chart
    const ctx = document.getElementById("myChart").getContext("2d");

    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [{
          label: "Values",
          data: [],
          tension: 0.3
        }]
      }
    });

    // ‚úÖ LOAD DATA WITH ERROR LOGGING
    async function loadData() {
      console.log("üîÅ Loading data from Supabase...");

      const { data, error } = await supabase
        .from("measurements")
        .select("*")
        .order("created_at", { ascending: true });

      if (error) {
        console.error("‚ùå LOAD ERROR:", error);
        alert("LOAD FAILED ‚Äî Check console");
        return;
      }

      console.log("‚úÖ Data loaded:", data);

      chart.data.labels = data.map(d =>
        new Date(d.created_at).toLocaleTimeString()
      );
      chart.data.datasets[0].data = data.map(d => d.value);
      chart.update();
    }

    // ‚úÖ INSERT DATA WITH FULL ERROR LOGGING
    async function addData() {
      const value = document.getElementById("valueInput").value;

      if (!value) {
        alert("Enter a value first");
        return;
      }

      console.log("‚¨ÜÔ∏è Inserting value:", value);

      const { data, error } = await supabase
        .from("measurements")
        .insert([{ value: parseFloat(value) }]);

      if (error) {
        console.error("‚ùå INSERT ERROR:", error);
        alert("INSERT FAILED ‚Äî Check console");
        return;
      }

      console.log("‚úÖ Insert successful:", data);

      document.getElementById("valueInput").value = "";
      loadData();
    }

    // ‚úÖ Initial Load
    loadData();

  </script>

</body>
</html>
