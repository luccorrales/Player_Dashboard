<script>
  const SUPABASE_URL = "https://sugekxazhhxmbzncqxyg.supabase.co";
  const SUPABASE_KEY = "sb_publishable_84h5tEu4ALMHkJWBxQeYdw_WqSSJiKd";

  // ‚úÖ FIXED: no name collision
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  console.log("‚úÖ Supabase client initialized");

  const ctx = document.getElementById("myChart").getContext("2d");

  const chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: [],
      datasets: [{
        label: "Values",
        data: [],
        tension: 0.3
      }]
    }
  });

  async function loadData() {
    console.log("üîÅ Loading data...");

    const { data, error } = await supabaseClient
      .from("measurements")
      .select("*")
      .order("created_at", { ascending: true });

    if (error) {
      console.error("‚ùå LOAD ERROR:", error);
      alert("LOAD FAILED ‚Äî Check console");
      return;
    }

    console.log("‚úÖ Data loaded:", data);

    chart.data.labels = data.map(d =>
      new Date(d.created_at).toLocaleTimeString()
    );

    chart.data.datasets[0].data = data.map(d => d.value);
    chart.update();
  }

  async function addData() {
    const value = document.getElementById("valueInput").value;

    if (!value) {
      alert("Enter a value first");
      return;
    }

    console.log("‚¨ÜÔ∏è Inserting value:", value);

    const { data, error } = await supabaseClient
      .from("measurements")
      .insert([{ value: parseFloat(value) }]);

    if (error) {
      console.error("‚ùå INSERT ERROR:", error);
      alert("INSERT FAILED ‚Äî Check console");
      return;
    }

    console.log("‚úÖ Insert successful:", data);

    document.getElementById("valueInput").value = "";
    loadData();
  }

  loadData();
</script>
