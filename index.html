<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supabase Plot Demo</title>

  <!-- ✅ Mobile-safe Supabase v1 SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@1.35.7"></script>

  <!-- ✅ Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <h1>Supabase Live Plot Demo</h1>
  <p id="status">Loading...</p>

  <input type="number" id="valueInput" placeholder="Enter a number">
  <button onclick="addData()">Add Data</button>

  <canvas id="myChart" width="400" height="200"></canvas>

  <script>
    const SUPABASE_URL = "https://sugekxazhhxmbzncqxyg.supabase.co";
    const SUPABASE_KEY = "sb_publishable_84h5tEu4ALMHkJWBxQeYdw_WqSSJiKd";

    // ✅ v1 syntax (mobile compatible)
    const supabaseClient = supabase.createClient(
      SUPABASE_URL,
      SUPABASE_KEY
    );

    document.getElementById("status").textContent = "✅ Supabase Connected";

    const ctx = document.getElementById("myChart").getContext("2d");

    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [{
          label: "Values",
          data: [],
          tension: 0.3
        }]
      }
    });

    async function loadData() {
      const { data, error } = await supabaseClient
        .from("measurements")
        .select("*")
        .order("created_at", { ascending: true });

      if (error) {
        console.error(error);
        document.getElementById("status").textContent = "❌ Load failed";
        return;
      }

      chart.data.labels = data.map(d =>
        new Date(d.created_at).toLocaleTimeString()
      );

      chart.data.datasets[0].data = data.map(d => d.value);
      chart.update();
    }

    async function addData() {
      const value = document.getElementById("valueInput").value;
      if (!value) return;

      const { error } = await supabaseClient
        .from("measurements")
        .insert([{ value: parseFloat(value) }]);

      if (error) {
        console.error(error);
        document.getElementById("status").textContent = "❌ Insert failed";
        return;
      }

      document.getElementById("valueInput").value = "";
      document.getElementById("status").textContent = "✅ Inserted!";
      loadData();
    }

    loadData();
  </script>

</body>
</html>
